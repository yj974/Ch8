# medicineShop

本项目具体可分为客户端、服务端和数据库三个部分，其中客户端使用JavaScript、HTML和CSS实现，部分组件来自vant，服务端主要使用python的flask框架实现，数据库环境为XAMPP中的MySQL。本项目具有商品信息的查询、删改，购物车，库存管理，物流追踪等功能。

本项目默认XAMPP的本地端口为8081；MySQL的本地端口为3306，本项目的所有功能在本地均经测试并可正常运行，如需上线，只需把服务端和数据库迁移至服务器，并更改前后端的相关静态数据（具体参照后文）即可。为模拟在服务器中获取图像的效果，本项目的测试数据库中的所有涉及在线url的内容均暂存在阿里云的对象存储内。

## 客户端

客户端是用户看到的界面，即小程序本体，小程序的大部分信息都是从服务端接收来的。在用户进入客户端时，会自动进行登录操作，向微信服务器发送本次会话的code码后获取用户的openid用于进行库存管理等操

作。为了确保用户在其他页面时一定为登陆状态，程序在加载首页时同样会进行一次登陆操作。客户端存储的某些静态信息（如服务器的域名）存储在 `/api/base.js` 中。

客户端分为多个页面，下面将逐个进行解释。

### 首页

首页的页面位置在 `pages/index` 其分为五个部分：

#### 搜索框

首页中的搜索框仅起到跳转作用，用户在点击搜索框后会跳转至真正的搜索页面，如此设计是为了可在项目的后期运营中添加热门搜索和搜索历史纪录等功能，增加拓展性。用户的搜索操作会在搜索页面进行。

#### 轮播图

此处可放置多张图片（尺寸以1080*470px为宜）。图片信息位于数据库中的 `swiper` 表中，数据库中的所有图片会在此循环播放。

#### 导航网格

用户可点击此处的图标跳转至对应的页面。

#### 商品列表

此处显示商品的简要信息，所有信息储存在数据库中的 `goods` 表中。用户可点击商品卡片进入商品的详情页面。为了防止服务端一次返回大量商品信息增加用户设备的负载，本页中一次只向服务端请求十条数据，带用户滑动到底部时会再向服务端请求接下来的十条数据，若服务端的数据已经全部被客户端获取过，会弹出暂无数据的提示。

#### 导航栏

此处固定显示常用的页面，方便用户随时点击跳转至对应的页面。

### 搜索页面

用户可点击首页中的搜索栏跳转至本页面，在本页中，用户可对所有商品进行检索，进行检索后会跳转至新的页面来展示搜索结果。在新页面的最上方有提示信息显示用户搜索的内容，下方则是搜索结果，服务端将返回标题中含有用户输入内容的所有商品的信息，本页同样具有首页中商品列表的分次请求数据的功能，此功能在这里不再赘述。如果用户搜索的内容在数据库中不存在，会显示“没有找到您搜索的商品”的字样及图标。

### 分类页面

本页按分类展示数据库中的所有商品，商品的类别需要手动设置，其位于数据库 `goods` 表的 `tag` 字段。另外，如需增加新的类别名称，需要更改 `category` 页面的初始数据 `category_name` 。除此外本页面的所有功能与首页中的商品列表相同，此处不再赘述。

### 商品详情页

本页展示的信息可分为四个板块。

第一个板块为商品头图，推荐比例为750:500，存储在 `goods` 表的 `topimage` 字段，如果希望展示多个头图（形式为不自动滚动的轮播图），需要提供所有头图的url，并用 `&&` 将他们分隔开。

第二个板块为商品的标题和价格，该部分信息来源于 `goods` 表的 `title` 和 `price` 字段，与商品列表中的信息完全一致。

第三个部分为商品详情图，存储在 `goods` 表的 `details` 字段，此处图片的最适宜形态为长图，主要介绍商品的详细信息，如需展示多个图片，他们的url需用 `&&` 分隔开。

最后的板块为业务栏，位于页面的最下方。点击购物车按钮即可跳转到购物车页面。

点击加入购物车按钮会打开弹出菜单，在菜单中会展示商品的简介图（ `goods` 表中的 `url` 字段）、可选最大商品数量、步进器以及确定按钮。这里的可选最大商品数量为该商品的库存数量与用户购物车中该商品的数量之差，步进器可选的最大值为可选最大数量，最小值为1，同时用户可以选择使用键盘输入数字，输入的数字会进行判断范围是否符合，若不符合则做出合理的取舍，在选择完商品数量后，用户可选择点击下方的确定按钮，届时用户选择的商品及数量信息会传入服务端并跳转至购物车页面。如果可选最大商品数量小于等于零，下方的确定按钮将会变为红色的无货按钮，届时用户点击将不做任何反应。

点击立即购买页面会弹出与点击加入购物车按钮时类似的弹出窗口，用户点击确定后会进入结算页面。

### 购物车页面

用户在进入购物车页面时，程序会向服务端请求用户的购物车信息（存储在 `cart` 表中）并加载至购物车页面，如果用户的购物车没有数据，则会显示特定页面提示用户购物车内暂无商品。若用户的购物车内存在商品，本页面会将所有的商品纵向排列，用户可以通过点击商品卡片中的标题和图片前往对应商品的详情页。

单个商品卡片的左端是商品的简介图和选择器，右侧是商品标题、价格和步进器，步进器的功能与商品详情页业务栏中的相同，再此不做赘述。用户可以选择选择器来挑选需要结算的商品，页面左下角的全选可以选择全部选择器。此外，用户除了将步进器清零外，还可以把商品卡片向左滑动，点击显示出的删除按钮将该商品移出购物车。

用户在本页选择商品后点击提交订单会跳转至结算页面。

### 结算页面

本页面分为三个部分。

第一个部分为填写地址栏，用户点击后会从页面下端弹出窗口来填写地址信息，当用户填写完全部两项地址信息后，页面最下方的去支付按钮方可点击。

第二部分时商品卡片，这里展示商品的标题，单价和购买数量，这里仅作展示作用，用户不可在此页面修改订单信息。

第三部分为业务栏，这里展示当前订单的总价和去支付按钮，除非用户点击去支付按钮，其余操作均不会对用户的购物车和库存信息造成任何影响。

### 支付页面

本页面只可以从结算页面跳转而来，如程序需上线运营，可以在此页面接入支付接口，这里只做模拟。

本页面的绿色页面模拟支付成功，库存数量和用户的购物车信息会根据用户的购买情况做相应的减少，点击弹出窗口的确定按钮后会前往首页。

本页面的红色按钮模拟支付失败，库存数量和用户的购物车信息均不做任何改变，点击弹出窗口的确定按钮后会返回购物车页面。

## 服务端

服务端是为客户端提供信息的软件，对后台数据的大部分处理操作都在服务端进行。服务端的功能为根据业务要求对数据库进行增删改查的操作，并响应客户端的GET、POST等请求。服务端存储的静态信息（如数据库的登录信息和小程序测试号的相关信息）位于 `/static/info.py` 中。服务端中开放的接收前端请求的地址均位于 `/api` 页面下，如 `http:localhost:5000/api/login` 。

服务端依赖的第三方包有：flask、requests、pandas、numpy、mysql-connector。主程序为 `app.py` ，可在终端中进入项目目录后运行 `flask run` 命令启动程序。

## 数据库

数据库用来存储本项目涉及到的大部分数据，如商品信息、商品列表等。下面将分别介绍各个表格的内容和含义

### `swiper`

本表共有 `id` 、 `url` 、 `name` 三个字段，其中主键为 `id` ，用来存储商品信息，类型为int。 `url` 用来存储单张图片的地址，类型为text。 `name` 用来存储商品名称，类型为text

### `goods`

本表共有 `id` 、 `title`  、`price`  、 `url` 、 `tag` 、`details` 、 `topimage` 、 `stock` 八个字段，其中主键为 `id` 用来存储商品的id，类型为int。 `title` 用来存储商品的标题，类型为text。 `price` 用来存储商品的价格，类型为double。 `url` 用来存储商品的简介图地址，类型为text。 `tag` 用来存储商品的类别，类型为varchar。 `details` 用来存储商品的详情图地址，多个地址间用 `&&`  分割，类型为text。 `topimage` 用来存储商品头图，多个地址间用 `&&` 分割，类型为text。 `stock` 用来存储商品的库存数量，类型为int。

### `cart`

本表共有 `openid` 、 `infoJson`  两个字段，其中主键为 `openid` 用来存储用户的openid（用户在本项目中的唯一标识，从微信服务器获取），类型为varchar。 `infoJson` 用来存储单个用户的购物车信息，由于购物车信息较为复杂且我们希望以用户为单位存储所有的购物信息，因此使用json类型来存储信息，本列中每一行都为一个json对象，其中包含的所有键均为商品id，类型为字符型，所有值均为购物车商品数量，类型为整型。

###  `orderinfo`

本表共有 `openid` 、 `orderInfo` 两个字段，其中主键为 `openid` 用来存储用户的openid，类型为varchar。 `orderInfo` 用来存储单个用户的订单信息，依然以json的形式储存，考虑到用户可能在不同时间对单一商品下多次订单，本字段中的键为用户某一笔订单的下单时间，以字符串形式储存，形式为（20240303112508，精确到秒），值为json对象，键为字符串类型的商品id，值为json对象，此对象中以键值对的形式存储商品数量和订单状态（如-1代表支付失败，0代表待支付，1代表支付成功，2代表待发货，3代表待收货，4代表订单完成），后续可将时间转为订单编号并将时间信息添加到二级json对象中，本字段的形式样例如下：

`{"20240303112508":{"1":{"amount":6, status:1}, "3":{"amount":2, "status":3}}, "20240303113120":{"1":{"amount":5, "status":-1}}}`

